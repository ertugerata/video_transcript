services:
  app:
    build: .
    volumes:
      - .:/app
    environment:
      - POCKETBASE_URL=http://pocketbase:8090
      - OLLAMA_URL=http://llm:11434
    depends_on:
      - pocketbase
      - llm
    command: python src/server.py

  pocketbase:
    image: alpine:latest
    entrypoint: [ "/bin/sh", "-c" ]
    command:
      - |
        wget https://github.com/pocketbase/pocketbase/releases/download/v0.22.8/pocketbase_0.22.8_linux_amd64.zip -O pb.zip
        unzip pb.zip
        ./pocketbase serve --http=0.0.0.0:8090
    ports:
      - "8090:8090"
    volumes:
      - pb_data:/pb_data

  llm:
    image: ollama/ollama:latest
    volumes:
      - ollama_data:/root/.ollama
    ports:
      - "11434:11434"

volumes:
  pb_data:
  ollama_data:
